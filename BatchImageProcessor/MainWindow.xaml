<Window x:Class="BatchImageProcessor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
		xmlns:controls="clr-namespace:BatchImageProcessor.Controls"
		xmlns:model="clr-namespace:BatchImageProcessor.Model"
		xmlns:viewmodel="clr-namespace:BatchImageProcessor.ViewModel"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Batch Image Processor" Height="720" Width="1280" MinWidth="800" MinHeight="600"
		UseLayoutRounding="True" SnapsToDevicePixels="True" Icon="Images/ImageRotator.ico" WindowStartupLocation="CenterScreen">
	<Window.Resources>
		<viewmodel:FileCollectionView x:Key="ficv" Source="{Binding SelectedItem.Files, ElementName=treeView}" />
		<viewmodel:FolderCollectionView x:Key="focv" Source="{Binding Children}" />
		<viewmodel:TypeConverter x:Key="typeConv"/>
		<Style x:Key="tvs" TargetType="TreeViewItem">
			<Setter Property="BorderThickness" Value="1"/>
			<Style.Triggers>
				<Trigger Property="IsSelected" Value="True">
					<Setter Property="BorderBrush" Value="#26A0DA"/>
				</Trigger>
				<MultiTrigger>
					<MultiTrigger.Conditions>
						<Condition Property="IsSelected" Value="True"/>
						<Condition Property="IsSelectionActive" Value="False"/>
					</MultiTrigger.Conditions>
					<Setter Property="BorderBrush" Value="#DEDEDE"/>
				</MultiTrigger>
			</Style.Triggers>
		</Style>

		<Style TargetType="{x:Type ListView}" BasedOn="{StaticResource {x:Type ListBox}}">
			<Setter Property="BorderBrush" Value="Black"/>
			<Setter Property="BorderThickness" Value="0.5"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate>
						<Border Name="bd" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}"
                Background="{TemplateBinding Background}" Margin="{TemplateBinding Margin}">
							<ScrollViewer Margin="{TemplateBinding Padding}">
								<controls:VirtualizingWrapPanel IsItemsHost="True" 
                       Width="{Binding ActualWidth,RelativeSource={RelativeSource AncestorType=ScrollContentPresenter}}" ScrollViewer.HorizontalScrollBarVisibility="Disabled" 
ScrollViewer.VerticalScrollBarVisibility="Auto">
								</controls:VirtualizingWrapPanel>
							</ScrollViewer>
						</Border>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<DropShadowEffect x:Key="dse" BlurRadius="5" ShadowDepth="0"/>
		<DropShadowEffect x:Key="tdse" Opacity="0.6" BlurRadius="6" ShadowDepth="0"/>
		<BitmapImage x:Key="fallback" CacheOption="OnLoad" UriSource="Images/refresh.png"/>
		<Style TargetType="Label">
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="Effect" Value="{StaticResource tdse}"/>
		</Style>
		<ControlTemplate x:Key="btn" TargetType="Button">
			<Border>
				<ContentPresenter/>
			</Border>
		</ControlTemplate>
		<Style TargetType="Button">
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Background" Value="{x:Null}"/>
			<Setter Property="Padding" Value="2"/>
			<Setter Property="Margin" Value="3"/>
			<Setter Property="Effect" Value="{StaticResource tdse}"/>
			<Setter Property="Template" Value="{StaticResource btn}"/>
			<Setter Property="Opacity" Value="0.8"/>
			<Style.Triggers>
				<EventTrigger RoutedEvent="Control.MouseEnter">
					<BeginStoryboard>
						<Storyboard >
							<DoubleAnimation Duration="0:0:0.1" To="1" Storyboard.TargetProperty="Opacity"/>
						</Storyboard>
					</BeginStoryboard>
				</EventTrigger>
				<EventTrigger RoutedEvent="Control.MouseLeave">
					<BeginStoryboard>
						<Storyboard >
							<DoubleAnimation Duration="0:0:0.1" To="0.75" Storyboard.TargetProperty="Opacity"/>
						</Storyboard>
					</BeginStoryboard>
				</EventTrigger>
			</Style.Triggers>
		</Style>
		
		<ContextMenu x:Key="imageCtxMenu">
			<MenuItem Header="Override Default Settings" IsCheckable="True"/>
		</ContextMenu>
	</Window.Resources>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="200" MinWidth="200" MaxWidth="400"/>
			<ColumnDefinition Width="*" MinWidth="400"/>
			<ColumnDefinition Width="300" MinWidth="300"/>
		</Grid.ColumnDefinitions>

		<Label Content="Folders" HorizontalAlignment="Center"/>
		<Label Grid.Column="1" Content="Files" HorizontalAlignment="Center"/>
		<Label Grid.Column="2" Content="Default Settings" HorizontalAlignment="Center"/>

		<StackPanel Orientation="Horizontal" Grid.Row="1" Margin="15,0" HorizontalAlignment="Center">
			<Button x:Name="importImageBtn" ToolTip="Import Image" Cursor="Hand">
				<Image Width="18" Height="18" Source="Images/image-import.png" Stretch="None" />
			</Button>
			<Line StrokeThickness="1" Margin="3" X1="0" X2="0" Y1="0" Stroke="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}" Y2="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"/>
			<Button x:Name="addFolderBtn" ToolTip="Add Folder" Cursor="Hand">
				<Image Width="18" Height="18" Source="Images/folder--plus.png" Stretch="None" />
			</Button>
			<Button x:Name="importFolderBtn" ToolTip="Import Folder" Cursor="Hand">
				<Image Width="18" Height="18" Source="Images/folder-import.png" Stretch="None" />
			</Button>
			<Line StrokeThickness="1" Margin="3" X1="0" X2="0" Y1="0" Stroke="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}" Y2="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"/>
			<Button x:Name="removeItemBtn" ToolTip="Remove Item" Cursor="Hand">
				<Image Width="18" Height="18" Source="Images/cross.png" Stretch="None" />
			</Button>
		</StackPanel>

		<StackPanel Orientation="Horizontal" Grid.Row="1" Grid.Column="1" Margin="15,0" HorizontalAlignment="Center">
			<Button x:Name="checkAllBtn" ToolTip="Check Selected Items" Cursor="Hand" Click="checkAllBtn_Click">
				<Image Width="18" Height="18" Source="Images/ui-check-box.png" Stretch="None" />
			</Button>
			<Button x:Name="uncheckBtn" ToolTip="Uncheck Selected Items" Cursor="Hand" Click="uncheckBtn_Click">
				<Image Width="18" Height="18" Source="Images/ui-check-box-uncheck.png" Stretch="None" />
			</Button>
			<Line StrokeThickness="1" Margin="3" X1="0" X2="0" Y1="0" Stroke="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}" Y2="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"/>
			<Button ToolTip="Rotate Counter Clockwise" Cursor="Hand">
				<Image Width="18" Height="18" Source="Images/arrow-circle-ccwise.png" Stretch="None" />
			</Button>
			<Button ToolTip="Rotate 180 Degrees" Cursor="Hand">
				<Image Width="18" Height="18" Source="Images/arrow-circle-180.png" Stretch="None" />
			</Button>
			<Button ToolTip="Rotate Clockwise" Cursor="Hand">
				<Image Width="18" Height="18" Source="Images/arrow-circle-cwise.png" Stretch="None" />
			</Button>
			<Line StrokeThickness="1" Margin="3" X1="0" X2="0" Y1="0" Stroke="{DynamicResource {x:Static SystemColors.ControlDarkBrushKey}}" Y2="{Binding ActualHeight, RelativeSource={RelativeSource Self}}"/>
			<Button x:Name="selectAllBtn" ToolTip="Select All" Cursor="Hand" Click="selectAllBtn_Click">
				<Image Width="18" Height="18" Source="Images/selection-select.png" Stretch="None" />
			</Button>
			<Button x:Name="deselectBtn" ToolTip="Select None" Cursor="Hand" Click="deselectBtn_Click">
				<Image Width="18" Height="18" Source="Images/selection.png" Stretch="None" />
			</Button>
		</StackPanel>

		<TreeView x:Name="treeView" Grid.Row="2" ItemsSource="{Binding Folders}" BorderThickness="0">
			<TreeView.Resources>
				<HierarchicalDataTemplate DataType="{x:Type viewmodel:Folder}" ItemsSource="{Binding Files}">
					<StackPanel Orientation="Horizontal" Cursor="Hand">
						<StackPanel.ContextMenu>
							<ContextMenu>
								<MenuItem Header="Remove Item">
									<MenuItem.Icon>
										<Image StretchDirection="DownOnly" Source="Images/cross.png" />
									</MenuItem.Icon>
								</MenuItem>
							</ContextMenu>
						</StackPanel.ContextMenu>
						<Image Source="Images/folder.png" />
						<TextBlock Text="{Binding Name}" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" Margin="5,1,5,1" ToolTip="{Binding Path}"/>
					</StackPanel>
				</HierarchicalDataTemplate>
				<DataTemplate DataType="{x:Type model:File}">
					<StackPanel Orientation="Horizontal" MouseRightButtonUp="Grid_MouseRightButtonUp">
						<Image Source="Images/image.png" />
						<TextBlock Text="{Binding Name, BindsDirectlyToSource=True, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" Margin="5,1,5,1">
							<TextBlock.ToolTip>
								<ToolTip>
									<Grid>
										<Grid.RowDefinitions>
											<RowDefinition Height="Auto"/>
											<RowDefinition Height="Auto"/>
										</Grid.RowDefinitions>
										<Image Source="{Binding Thumbnail, FallbackValue={StaticResource fallback}, IsAsync=True}" StretchDirection="DownOnly" MaxWidth="400" MaxHeight="300"/>
										<TextBlock Grid.Row="1" Text="{Binding Path}"/>
									</Grid>
								</ToolTip>
							</TextBlock.ToolTip>
						</TextBlock>
					</StackPanel>
				</DataTemplate>
				<Style TargetType="TreeViewItem" BasedOn="{StaticResource tvs}">
					<Style.Triggers>
						<DataTrigger Value="{x:Type model:File}" Binding="{Binding Converter={StaticResource typeConv}, Mode=OneWay}">
							<Setter Property="Focusable" Value="False"/>
						</DataTrigger>
					</Style.Triggers>
				</Style>
			</TreeView.Resources>
		</TreeView>

		<GridSplitter Grid.Row="2" Grid.Column="1" Width="3" ResizeDirection="Columns" HorizontalAlignment="Left" IsTabStop="False">
			<GridSplitter.Background>
				<LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
					<GradientStop Color="Transparent" Offset="0"/>
					<GradientStop Color="{DynamicResource {x:Static SystemColors.ControlLightColorKey}}" Offset="0.5"/>
					<GradientStop Color="Transparent" Offset="1"/>
				</LinearGradientBrush>
			</GridSplitter.Background>
		</GridSplitter>
		<ListView Grid.Row="2" Grid.Column="1" x:Name="listView" ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Auto"
				  ItemsSource="{Binding Source={StaticResource ficv}}" Margin="3,0,0,0">
			<ListView.ItemTemplate>
				<DataTemplate DataType="{x:Type viewmodel:FileWrapper}">
					<Grid VerticalAlignment="Center" Margin="0,3,0,0" ToolTip="{Binding Path}" MouseRightButtonUp="Grid_MouseRightButtonUp">
						<Grid.RowDefinitions>
							<RowDefinition Height="*"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>
						<Image Source="{Binding Thumbnail, FallbackValue={StaticResource fallback}, IsAsync=True}" StretchDirection="DownOnly" Width="128" Height="128" Margin="3" Effect="{DynamicResource dse}"/>
						<CheckBox IsChecked="{Binding Selected}" VerticalAlignment="Top"/>
						<TextBlock Grid.Row="1" TextWrapping="Wrap" TextTrimming="CharacterEllipsis" Text="{Binding Name}" MaxWidth="128" MaxHeight="40" TextAlignment="Center"/>
					</Grid>
				</DataTemplate>
			</ListView.ItemTemplate>
		</ListView>
		<Grid Grid.Column="2" Grid.Row="2">
			<Grid.RowDefinitions>
				<RowDefinition Height="Auto"/>
				<RowDefinition Height="*"/>
				<RowDefinition Height="Auto"/>
			</Grid.RowDefinitions>
			<ListBox VerticalAlignment="Top" Height="Auto" BorderThickness="0" SelectedIndex="0">
				<ListBox.Resources>
					<Style TargetType="{x:Type CheckBox}">
						<Style.Triggers>
							<EventTrigger RoutedEvent="ToggleButton.Checked">
								<BeginStoryboard>
									<Storyboard >
										<DoubleAnimation Duration="0:0:0.1" To="1" Storyboard.TargetProperty="Content.Opacity"/>
									</Storyboard>
								</BeginStoryboard>
							</EventTrigger>
							<EventTrigger RoutedEvent="ToggleButton.Unchecked">
								<BeginStoryboard>
									<Storyboard>
										<DoubleAnimation Duration="0:0:0.1" To="0.5" Storyboard.TargetProperty="Content.Opacity"/>
									</Storyboard>
								</BeginStoryboard>
							</EventTrigger>
						</Style.Triggers>
					</Style>
				</ListBox.Resources>
				<ListBoxItem>
					<StackPanel Orientation="Horizontal" Margin="25,0">
						<Image Source="Images/image-rotate.png"/>
						<Label Content="Rotate"/>
					</StackPanel>
				</ListBoxItem>
				<ListBoxItem>
					<CheckBox VerticalContentAlignment="Center">
						<StackPanel Orientation="Horizontal" Margin="5,0" Opacity="0.5">
							<Image Source="Images/image-resize-actual.png"/>
							<Label Content="Resize"/>
						</StackPanel>
					</CheckBox>
				</ListBoxItem>
				<ListBoxItem>
					<CheckBox VerticalContentAlignment="Center">
						<StackPanel Orientation="Horizontal" Margin="5,0" Opacity="0.5">
							<Image Source="Images/image-crop.png"/>
							<Label Content="Crop"/>
						</StackPanel>
					</CheckBox>
				</ListBoxItem>
				<ListBoxItem>
					<CheckBox VerticalContentAlignment="Center">
						<StackPanel Orientation="Horizontal" Margin="5,0" Opacity="0.5">
							<Image Source="Images/image-saturation.png" />
							<Label Content="Watermark"/>
						</StackPanel>
					</CheckBox>
				</ListBoxItem>
				<ListBoxItem>
					<StackPanel Orientation="Horizontal" Margin="25,0">
						<Image Source="Images/image-export.png" />
						<Label Content="Output"/>
					</StackPanel>
				</ListBoxItem>
			</ListBox>
			<!--<ContentControl Grid.Row="1" Content="{Binding}"-->
			<Button Grid.Row="2" HorizontalAlignment="Center" Margin="10,0" Cursor="Hand">
				<StackPanel Orientation="Horizontal">
					<Label Content="Start Processing" FontSize="20" Margin="0,0,10,0" FontFamily="Segoe UI Light"/>
					<Image Source="Images/32/image-transition.png" VerticalAlignment="Center"/>
				</StackPanel>
			</Button>
		</Grid>
	</Grid>
</Window>
